function Q = newtoncotes_xue(fun,a,b,n)

xg = zeros(n+1,1);
wg = zeros(n+1,1);
if n == 0
    xg(1) = (a+b)/2;
    wg(1) = 1;
else
    xg = a+(b-a)*(0:n)'/n;
    if n == 1
        wg = [1 1]'/2;
    elseif n == 2
        wg = [1 4 1]'/6;
    elseif n == 3
        wg = [1 3 3 1]'/8;
    elseif n == 4
        wg = [7 32 12 32 7]'/90;
    elseif n == 5
        wg = [19 75 50 50 75 19]'/288;
    elseif n == 6
        wg = [41 216 27 272 27 216 41]'/840;
    elseif n == 7
        wg = [751 3577 1323 2989 2989 1323 3577 751]'/17280;
    elseif n == 8
        wg = [989 5888 -928 10496 -4540 10496 -928 5888 989]'/28350;
    elseif n == 9
        wg(1:ceil((n+1)/2)) = [2857 15741 1080 19344 5778]'/89600;
        wg(end-ceil((n+1)/2)+1:end) = flipud(wg(1:ceil((n+1)/2)));
    elseif n == 10
        wg(1:ceil((n+1)/2)) = [16067 106300 -48525 272400 -260550 ...
                               427368]'/598752;
        wg(end-ceil((n+1)/2)+1:end) = flipud(wg(1:ceil((n+1)/2)));
    elseif n == 11
        wg(1:ceil((n+1)/2)) = [2171465 13486539 -3237113 25226685 ...
                               -9595542 15493566]'/87091200;
        wg(end-ceil((n+1)/2)+1:end) = flipud(wg(1:ceil((n+1)/2)));
    elseif n == 12
        wg(1:ceil((n+1)/2)) = [1364651 9903168  -7587864 35725120 ...
                               -51491295 87516288 -87797136]'/63063000;
        wg(end-ceil((n+1)/2)+1:end) = flipud(wg(1:ceil((n+1)/2)));
    elseif n == 13
        wg(1:ceil((n+1)/2)) = [8181904909 56280729661 -31268252574 ...
                               156074417954 -151659573325 ...
                               206683437987 -43111992612]'/402361344000;
        wg(end-ceil((n+1)/2)+1:end) = flipud(wg(1:ceil((n+1)/2)));
    elseif n == 14
        wg(1:ceil((n+1)/2)) = [90241897 710986864 -770720657 3501442784 ...
                               -6625093363 12630121616 -16802270373 ...
                               19534438464]'/5003856000;
        wg(end-ceil((n+1)/2)+1:end) = flipud(wg(1:ceil((n+1)/2)));
    elseif n == 15
        wg(1:ceil((n+1)/2)) = [35310023 265553865 -232936065 1047777585 ...
                               -1562840685  2461884669 -2000332805 ...
                               1018807605]'/2066448384;
        wg(end-ceil((n+1)/2)+1:end) = flipud(wg(1:ceil((n+1)/2)));
    elseif n == 16
        wg(1:ceil((n+1)/2)) = [15043611773 127626606592 -179731134720 ... 
                               832211855360 -1929498607520 4177588893696 ...
                               -6806534407936 9368875018240 ...
                               -10234238972220]'/976924698750;
        wg(end-ceil((n+1)/2)+1:end) = flipud(wg(1:ceil((n+1)/2)));
    elseif n == 17
        wg(1:ceil((n+1)/2)) = [55294720874657 450185515446285 ...
                               -542023437008852 2428636525764260 ...
                               -4768916800123440 8855416648684984 ...
                               -10905371859796660 10069615750132836 ...
                               -3759785974054070]'/3766102179840000;
        wg(end-ceil((n+1)/2)+1:end) = flipud(wg(1:ceil((n+1)/2)));
    elseif n == 18
        wg(1:ceil((n+1)/2)) = [203732352169 1848730221900 ...
                               -3212744374395 15529830312096 ...
                               -42368630685840 103680563465808 ...
                               -198648429867720 319035784479840 ...
                               -419127951114198 461327344340680]'/...
                               15209113920000;
        wg(end-ceil((n+1)/2)+1:end) = flipud(wg(1:ceil((n+1)/2)));
    elseif n == 19
        wg(1:ceil((n+1)/2)) = [69028763155644023 603652082270808125 ...
                               -926840515700222955 4301581538450500095 ...
                               -10343692234243192788 22336420328479961316 ...
                               -35331888421114781580 43920768370565135580 ...
                               -37088370261379851390 15148337305921759574]'/...
                               5377993912811520000;
        wg(end-ceil((n+1)/2)+1:end) = flipud(wg(1:ceil((n+1)/2)));
    elseif n == 20
        wg(1:ceil((n+1)/2)) = [19470140241329 187926090380000 ...
                               -389358194177500 1985969159340000 ...
                               -6208948835889375 17019387776517504 ...
                               -37389734671290000 68869287574320000 ...
                               -105499014813701250 136324521798440000 ...
                               -148192526607280936]'/1646485441080480;
        wg(end-ceil((n+1)/2)+1:end) = flipud(wg(1:ceil((n+1)/2)));
    elseif n > 20
        error('Newton-Cotes: # of subintervals must be <= 21');
    end
end
Q = wg'*fun(xg)*(b-a);
